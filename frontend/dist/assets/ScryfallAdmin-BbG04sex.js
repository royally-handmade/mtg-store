import{_ as Q,W as X,a as N,c as a,b as r,d as s,e as c,F as C,j as T,L as U,t as n,I as K,q as x,J as D,g as A,v as M,h as W,M as Z,Z as G,f as H,r as m,n as Y,o as $,m as E}from"./index-D5lSLxc0.js";import{r as ee}from"./ExclamationTriangleIcon-qqwZ6LDi.js";import{r as se}from"./CheckCircleIcon-CPskrV3K.js";const te={name:"ScryfallAdmin",components:{CheckCircleIcon:se,XCircleIcon:X,ExclamationTriangleIcon:ee},setup(){const V=m("single"),o=[{id:"single",label:"Single Card"},{id:"sets",label:"Set Import"},{id:"search",label:"Search & Preview"},{id:"bulk",label:"Bulk Import"}],y=m({name:"",set_code:"",card_num:""}),e=m({single:!1,set:!1,search:!1,bulk:!1}),k=m({single:null}),P=m([]),f=m(""),u=m(null),S=m(""),_=m([]),h=m(!1),w=m("default_cards"),d=m(null),t=Y(()=>P.value.find(i=>i.code===f.value)),I=async()=>{var i,g;e.value.single=!0,k.value.single=null;try{const p=await E.post("/scryfall/import-card",{name:y.value.name,set_code:y.value.set_code||void 0,card_num:y.value.card_num||void 0});k.value.single={success:!0,message:p.data.message,card:p.data.card},y.value={name:"",set_code:""}}catch(p){k.value.single={success:!1,message:((g=(i=p.response)==null?void 0:i.data)==null?void 0:g.error)||"Import failed"}}finally{e.value.single=!1}},v=async()=>{try{const i=await E.get("/scryfall/sets");P.value=i.data}catch(i){console.error("Error loading sets:",i)}},O=async()=>{if(f.value){e.value.set=!0,u.value={imported:0,errors:0,percentage:0,logs:[]};try{const g=(await fetch("/api/scryfall/import-set",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({set_code:f.value})})).body.getReader(),p=new TextDecoder;for(;;){const{done:R,value:B}=await g.read();if(R)break;const L=p.decode(B).split(`
`).filter(b=>b.trim());for(const b of L)try{const l=JSON.parse(b);l.type==="start"?u.value.logs.push({id:Date.now(),message:`Starting import of ${l.set} (${l.card_count} cards)`}):l.type==="progress"?(u.value.imported=l.imported,u.value.errors=l.errors,u.value.logs.push({id:Date.now(),message:`Page ${l.page}: ${l.current_batch} cards processed`})):l.type==="complete"?(u.value.logs.push({id:Date.now(),message:`Import complete: ${l.imported} imported, ${l.errors} errors`}),await v()):l.type==="error"&&u.value.logs.push({id:Date.now(),message:`Error: ${l.error}`})}catch(l){console.error("Error parsing response:",l)}}}catch(i){console.error("Error importing set:",i)}finally{e.value.set=!1}}},z=async()=>{if(S.value.trim()){h.value=!0;try{const i=await E.get("/scryfall/search",{params:{q:S.value}});_.value=i.data.cards||[]}catch(i){console.error("Error searching:",i),_.value=[]}finally{h.value=!1}}},j=async i=>{e.value.search=!0;try{await E.post("/scryfall/import-card",{name:i.name,set_code:i.set}),i.is_imported=!0}catch(g){console.error("Error importing card:",g)}finally{e.value.search=!1}},q=async()=>{if(confirm("This will import all Magic cards from Scryfall. This process can take 30+ minutes. Continue?")){e.value.bulk=!0,d.value={processed:0,imported:0,errors:0,logs:[]};try{const g=(await fetch("/api/scryfall/bulk-import",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({type:w.value,batch_size:1e3})})).body.getReader(),p=new TextDecoder;for(;;){const{done:R,value:B}=await g.read();if(R)break;const L=p.decode(B).split(`
`).filter(b=>b.trim());for(const b of L)try{const l=JSON.parse(b);l.type==="start"?d.value.logs.push({id:Date.now(),message:l.message}):l.type==="info"?d.value.logs.push({id:Date.now(),message:l.message}):l.type==="progress"?(d.value.processed=l.processed,d.value.imported=l.imported,d.value.errors=l.errors,d.value.logs.push({id:Date.now(),message:`Processed: ${l.processed.toLocaleString()}, Imported: ${l.imported.toLocaleString()}, Errors: ${l.errors.toLocaleString()}`})):l.type==="complete"?d.value.logs.push({id:Date.now(),message:`Bulk import complete! Processed: ${l.total_processed.toLocaleString()}, Imported: ${l.total_imported.toLocaleString()}, Errors: ${l.total_errors.toLocaleString()}`}):l.type==="error"&&d.value.logs.push({id:Date.now(),message:`Error: ${l.error}`}),d.value.logs.length>50&&(d.value.logs=d.value.logs.slice(-50))}catch(l){console.error("Error parsing response:",l)}}}catch(i){console.error("Error in bulk import:",i)}finally{e.value.bulk=!1}}},J=i=>new Date(i).toLocaleDateString();return $(()=>{v()}),{activeTab:V,tabs:o,singleCard:y,importing:e,importResults:k,availableSets:P,selectedSet:f,selectedSetInfo:t,setImportProgress:u,searchQuery:S,searchResults:_,searching:h,bulkImportType:w,bulkImportProgress:d,importSingleCard:I,loadAvailableSets:v,importSet:O,searchScryfall:z,importCardFromSearch:j,startBulkImport:q,formatDate:J}}},oe={class:"scryfall-admin p-6"},re={class:"tab-nav mb-6"},le={class:"flex space-x-8 border-b border-gray-200"},ae=["onClick"],ne={key:0,class:"space-y-6"},ie={class:"bg-white rounded-lg shadow p-6"},de={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce=["disabled"],me={key:0},ue={key:1},ge={class:"flex"},pe={class:"flex-shrink-0"},be={class:"ml-3"},ye={key:0,class:"mt-2"},fe={class:"flex items-center space-x-3"},_e=["src","alt"],he={class:"font-medium"},ve={class:"text-sm text-gray-600"},xe={key:1,class:"space-y-6"},ke={class:"bg-white rounded-lg shadow p-6"},Se={class:"mb-6"},we={class:"relative"},Ie=["value"],Ce={key:0},Te={key:1},Pe={key:0,class:"mb-6 p-4 bg-gray-50 rounded-md"},De={class:"flex items-center space-x-4"},Ee=["src","alt"],Re={class:"font-medium"},Be={class:"text-sm text-gray-600"},Le=["disabled"],Ne={key:0},Ue={key:1},Ve={key:1,class:"mt-6"},Oe={class:"bg-blue-50 border border-blue-200 rounded-md p-4"},Ae={class:"mt-2"},Me={class:"bg-blue-200 rounded-full h-2"},ze={class:"mt-2 text-sm text-blue-800"},je={class:"mt-3 max-h-40 overflow-y-auto text-xs font-mono bg-white p-2 rounded border"},qe={key:2,class:"space-y-6"},Je={class:"bg-white rounded-lg shadow p-6"},Fe={class:"mb-6"},Qe={class:"flex space-x-4"},Xe={class:"flex-1"},Ke=["disabled"],We={key:0},Ze={key:1},Ge={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},He={class:"flex space-x-3"},Ye=["src","alt"],$e={class:"flex-1 min-w-0"},es={class:"font-medium text-gray-900 truncate"},ss={class:"text-sm text-gray-600"},ts={class:"text-sm text-gray-500 capitalize"},os={class:"mt-2 flex items-center justify-between"},rs={class:"text-sm"},ls={key:0,class:"text-green-600"},as={key:1,class:"text-gray-400"},ns={class:"flex items-center space-x-2"},is={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},ds=["onClick","disabled"],cs={key:3,class:"space-y-6"},ms={class:"bg-white rounded-lg shadow p-6"},us={class:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-6"},gs={class:"flex"},ps={class:"space-y-4"},bs=["disabled"],ys={key:0},fs={key:1},_s={key:0,class:"mt-6"},hs={class:"bg-gray-50 border border-gray-200 rounded-md p-4"},vs={class:"mt-2 space-y-2"},xs={class:"text-sm"},ks={class:"max-h-40 overflow-y-auto text-xs font-mono bg-white p-2 rounded border"};function Ss(V,o,y,e,k,P){var _,h,w,d;const f=N("CheckCircleIcon"),u=N("XCircleIcon"),S=N("ExclamationTriangleIcon");return r(),a("div",oe,[o[25]||(o[25]=s("div",{class:"header mb-8"},[s("h1",{class:"text-3xl font-bold text-gray-900 mb-2"},"Scryfall Integration"),s("p",{class:"text-gray-600"},"Import and manage card data from Scryfall API")],-1)),s("div",re,[s("nav",le,[(r(!0),a(C,null,T(e.tabs,t=>(r(),a("button",{key:t.id,onClick:I=>e.activeTab=t.id,class:U(["py-2 px-1 border-b-2 font-medium text-sm",e.activeTab===t.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},n(t.label),11,ae))),128))])]),e.activeTab==="single"?(r(),a("div",ne,[s("div",ie,[o[14]||(o[14]=s("h2",{class:"text-xl font-semibold mb-4"},"Import Single Card",-1)),s("form",{onSubmit:o[3]||(o[3]=K((...t)=>e.importSingleCard&&e.importSingleCard(...t),["prevent"])),class:"space-y-4"},[s("div",de,[s("div",null,[o[11]||(o[11]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Card Name * ",-1)),x(s("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>e.singleCard.name=t),type:"text",required:"",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Lightning Bolt"},null,512),[[D,e.singleCard.name]])]),s("div",null,[o[12]||(o[12]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Set Code (Optional) ",-1)),x(s("input",{"onUpdate:modelValue":o[1]||(o[1]=t=>e.singleCard.set_code=t),type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"lea"},null,512),[[D,e.singleCard.set_code]])]),s("div",null,[o[13]||(o[13]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Collector Number (Optional) ",-1)),x(s("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>e.singleCard.card_num=t),type:"text",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"lea"},null,512),[[D,e.singleCard.card_num]])])]),s("button",{type:"submit",disabled:e.importing.single,class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[e.importing.single?(r(),a("span",me,"Importing...")):(r(),a("span",ue,"Import Card"))],8,ce)],32),e.importResults.single?(r(),a("div",{key:0,class:U(["mt-4 p-4 rounded-md",e.importResults.single.success?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"])},[s("div",ge,[s("div",pe,[e.importResults.single.success?(r(),A(f,{key:0,class:"h-5 w-5 text-green-400"})):(r(),A(u,{key:1,class:"h-5 w-5 text-red-400"}))]),s("div",be,[s("p",{class:U(["text-sm font-medium",e.importResults.single.success?"text-green-800":"text-red-800"])},n(e.importResults.single.message),3),e.importResults.single.card?(r(),a("div",ye,[s("div",fe,[s("img",{src:e.importResults.single.card.image_url_small,alt:e.importResults.single.card.name,class:"w-16 rounded-md"},null,8,_e),s("div",null,[s("p",he,n(e.importResults.single.card.name),1),s("p",ve,n(e.importResults.single.card.set_name)+" ("+n((_=e.importResults.single.card.set_number)==null?void 0:_.toUpperCase())+")",1)])])])):c("",!0)])])],2)):c("",!0)])])):c("",!0),e.activeTab==="sets"?(r(),a("div",xe,[s("div",ke,[o[18]||(o[18]=s("h2",{class:"text-xl font-semibold mb-4"},"Import Complete Set",-1)),s("div",Se,[o[16]||(o[16]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Select Set to Import ",-1)),s("div",we,[x(s("select",{"onUpdate:modelValue":o[4]||(o[4]=t=>e.selectedSet=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[o[15]||(o[15]=s("option",{value:""},"Choose a set...",-1)),(r(!0),a(C,null,T(e.availableSets,t=>(r(),a("option",{key:t.code,value:t.code},[W(n(t.name)+" ("+n(t.code.toUpperCase())+") - "+n(t.card_count)+" cards ",1),t.is_fully_imported?(r(),a("span",Ce," ✓ Imported")):t.imported_count>0?(r(),a("span",Te," ("+n(t.import_percentage)+"% imported)",1)):c("",!0)],8,Ie))),128))],512),[[M,e.selectedSet]])])]),e.selectedSetInfo?(r(),a("div",Pe,[s("div",De,[e.selectedSetInfo.icon_svg_uri?(r(),a("img",{key:0,src:e.selectedSetInfo.icon_svg_uri,alt:e.selectedSetInfo.name,class:"w-8 h-8"},null,8,Ee)):c("",!0),s("div",null,[s("h3",Re,n(e.selectedSetInfo.name),1),s("p",Be," Released: "+n(e.formatDate(e.selectedSetInfo.released_at))+" | "+n(e.selectedSetInfo.card_count)+" cards | "+n(e.selectedSetInfo.imported_count)+"/"+n(e.selectedSetInfo.card_count)+" imported ("+n(e.selectedSetInfo.import_percentage)+"%) ",1)])])])):c("",!0),s("button",{onClick:o[5]||(o[5]=(...t)=>e.importSet&&e.importSet(...t)),disabled:!e.selectedSet||e.importing.set,class:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"},[e.importing.set?(r(),a("span",Ne,"Importing Set...")):(r(),a("span",Ue,"Import Set"))],8,Le),e.setImportProgress?(r(),a("div",Ve,[s("div",Oe,[o[17]||(o[17]=s("h4",{class:"font-medium text-blue-900"},"Import Progress",-1)),s("div",Ae,[s("div",Me,[s("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Z({width:e.setImportProgress.percentage+"%"})},null,4)]),s("div",ze,n(e.setImportProgress.imported)+" imported, "+n(e.setImportProgress.errors)+" errors ",1)]),s("div",je,[(r(!0),a(C,null,T(e.setImportProgress.logs,t=>(r(),a("div",{key:t.id,class:"text-gray-700"},n(t.message),1))),128))])])])):c("",!0)])])):c("",!0),e.activeTab==="search"?(r(),a("div",qe,[s("div",Je,[o[19]||(o[19]=s("h2",{class:"text-xl font-semibold mb-4"},"Search Scryfall",-1)),s("div",Fe,[s("div",Qe,[s("div",Xe,[x(s("input",{"onUpdate:modelValue":o[6]||(o[6]=t=>e.searchQuery=t),onKeyup:o[7]||(o[7]=G((...t)=>e.searchScryfall&&e.searchScryfall(...t),["enter"])),type:"text",placeholder:"Search for cards... (e.g., 'Lightning Bolt', 'set:lea', 'cmc:1')",class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},null,544),[[D,e.searchQuery]])]),s("button",{onClick:o[8]||(o[8]=(...t)=>e.searchScryfall&&e.searchScryfall(...t)),disabled:!e.searchQuery||e.searching,class:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50"},[e.searching?(r(),a("span",We,"Searching...")):(r(),a("span",Ze,"Search"))],8,Ke)])]),e.searchResults.length>0?(r(),a("div",Ge,[(r(!0),a(C,null,T(e.searchResults,t=>{var I,v;return r(),a("div",{key:t.scryfall_id,class:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow"},[s("div",He,[s("img",{src:t.image_url,alt:t.name,class:"w-16 rounded-md object-cover"},null,8,Ye),s("div",$e,[s("h3",es,n(t.name),1),s("p",ss,n(t.set_name)+" ("+n((I=t.set)==null?void 0:I.toUpperCase())+")",1),s("p",ts,n(t.rarity),1),s("div",os,[s("div",rs,[(v=t.prices)!=null&&v.usd?(r(),a("span",ls,"$"+n(t.prices.usd),1)):(r(),a("span",as,"No price"))]),s("div",ns,[t.is_imported?(r(),a("span",is," ✓ Imported ")):c("",!0),s("button",{onClick:O=>e.importCardFromSearch(t),disabled:t.is_imported||e.importing.search,class:"text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700 disabled:opacity-50"}," Import ",8,ds)])])])])])}),128))])):c("",!0)])])):c("",!0),e.activeTab==="bulk"?(r(),a("div",cs,[s("div",ms,[o[24]||(o[24]=s("h2",{class:"text-xl font-semibold mb-4"},"Bulk Import",-1)),s("div",us,[s("div",gs,[H(S,{class:"h-5 w-5 text-yellow-400 mt-0.5"}),o[20]||(o[20]=s("div",{class:"ml-3"},[s("h3",{class:"text-sm font-medium text-yellow-800"},"Warning"),s("p",{class:"text-sm text-yellow-700 mt-1"}," Bulk import will download and process all Magic cards from Scryfall. This process can take 30+ minutes and will import 80,000+ cards. ")],-1))])]),s("div",ps,[s("div",null,[o[22]||(o[22]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Import Type ",-1)),x(s("select",{"onUpdate:modelValue":o[9]||(o[9]=t=>e.bulkImportType=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"},[...o[21]||(o[21]=[s("option",{value:"default_cards"},"Default Cards (recommended)",-1),s("option",{value:"oracle_cards"},"Oracle Cards",-1),s("option",{value:"unique_artwork"},"Unique Artwork",-1),s("option",{value:"all_cards"},"All Cards (includes tokens)",-1)])],512),[[M,e.bulkImportType]])]),s("button",{onClick:o[10]||(o[10]=(...t)=>e.startBulkImport&&e.startBulkImport(...t)),disabled:e.importing.bulk,class:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50"},[e.importing.bulk?(r(),a("span",ys,"Importing...")):(r(),a("span",fs,"Start Bulk Import"))],8,bs)]),e.bulkImportProgress?(r(),a("div",_s,[s("div",hs,[o[23]||(o[23]=s("h4",{class:"font-medium text-gray-900"},"Bulk Import Progress",-1)),s("div",vs,[s("div",xs," Processed: "+n(((h=e.bulkImportProgress.processed)==null?void 0:h.toLocaleString())||0)+" | Imported: "+n(((w=e.bulkImportProgress.imported)==null?void 0:w.toLocaleString())||0)+" | Errors: "+n(((d=e.bulkImportProgress.errors)==null?void 0:d.toLocaleString())||0),1),s("div",ks,[(r(!0),a(C,null,T(e.bulkImportProgress.logs,t=>(r(),a("div",{key:t.id,class:"text-gray-700"},n(t.message),1))),128))])])])])):c("",!0)])])):c("",!0)])}const Ts=Q(te,[["render",Ss],["__scopeId","data-v-86bc7dfa"]]);export{Ts as default};
