import{G as T,r as x,c as g,b as p,d as e,f as w,i as $,H as P,q as D,J as U,t as n,n as b,o as q,g as B,e as E,F as k,j as C,v as M,m as y}from"./index-D5lSLxc0.js";import{r as z}from"./TrashIcon-Ok0xa92g.js";const V={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},G={class:"bg-white rounded-lg p-6 w-full max-w-lg"},N={class:"flex justify-between items-center mb-6"},O={class:"space-y-6"},I={class:"border-2 border-dashed border-gray-300 rounded-lg p-4 text-center"},R={class:"flex space-x-4"},H=["disabled"],J={__name:"DecklistUploadModal",emits:["close","uploaded"],setup(L,{emit:i}){const v=i,m=T(),a=x(""),u=x(!1),f=r=>{const l=r.target.files[0];if(l){const d=new FileReader;d.onload=_=>{a.value=_.target.result},d.readAsText(l)}},h=async()=>{if(a.value.trim()){u.value=!0;try{v("uploaded",a.value.trim()),m.success("Decklist processed successfully!"),v("close")}catch(r){m.error("Error processing decklist"),console.error("Decklist processing error:",r)}finally{u.value=!1}}};return(r,l)=>(p(),g("div",V,[e("div",G,[e("div",N,[l[4]||(l[4]=e("h2",{class:"text-xl font-bold"},"Upload Decklist",-1)),e("button",{onClick:l[0]||(l[0]=d=>r.$emit("close")),class:"text-gray-500 hover:text-gray-700"},[w($(P),{class:"h-6 w-6"})])]),e("div",O,[e("div",null,[l[5]||(l[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Paste Decklist ",-1)),D(e("textarea",{"onUpdate:modelValue":l[1]||(l[1]=d=>a.value=d),rows:"12",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:`4 Lightning Bolt\r
3 Counterspell\r
2 Snapcaster Mage\r
...`},null,512),[[U,a.value]])]),l[7]||(l[7]=e("div",{class:"text-center"},[e("span",{class:"text-gray-500"},"or")],-1)),e("div",null,[l[6]||(l[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Upload File ",-1)),e("div",I,[e("input",{ref:"fileInput",type:"file",accept:".txt,.dec",onChange:f,class:"hidden"},null,544),e("button",{onClick:l[2]||(l[2]=d=>r.$refs.fileInput.click()),type:"button",class:"text-blue-600 hover:text-blue-800"}," Choose decklist file (.txt, .dec) ")])]),l[8]||(l[8]=e("div",{class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},[e("h3",{class:"font-medium text-blue-900 mb-2"},"Supported Formats:"),e("ul",{class:"text-sm text-blue-800 space-y-1"},[e("li",null,"• MTG Arena export format"),e("li",null,"• MTGO .dec files"),e("li",null,'• Plain text (e.g., "4 Lightning Bolt")'),e("li",null,"• One card per line with quantity")])],-1)),e("div",R,[e("button",{onClick:l[3]||(l[3]=d=>r.$emit("close")),type:"button",class:"flex-1 btn-secondary"}," Cancel "),e("button",{onClick:h,disabled:!a.value.trim()||u.value,class:"flex-1 btn-primary disabled:opacity-50"},n(u.value?"Processing...":"Process Decklist"),9,H)])])])]))}},K={class:"space-y-6"},Q={class:"flex justify-between items-center"},W={class:"flex space-x-4"},X={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},Y={class:"lg:col-span-2 bg-white rounded-lg shadow p-6"},Z={class:"space-y-3"},ee={class:"flex items-center space-x-3"},te=["src","alt"],se={class:"font-medium"},le={class:"text-sm text-gray-600"},oe={class:"text-xs text-gray-400"},ne={class:"flex items-center space-x-2"},ie=["onUpdate:modelValue","onChange"],ae=["value"],re=["onClick"],de={class:"mt-6 pt-4 border-t"},ce={class:"flex justify-between items-center text-lg font-bold"},ue={class:"bg-white rounded-lg shadow p-6"},pe={class:"space-y-2 text-sm"},ve={class:"flex justify-between"},me={class:"flex justify-between"},be={class:"flex justify-between"},ge={class:"border-t pt-2 flex justify-between font-bold"},xe={class:"mt-4 text-sm text-gray-600"},fe=.13,_e={__name:"DeckBuilder",setup(L){const i=x([]),v=x(!1),m=x(0),a=b(()=>i.value.reduce((s,t)=>s+t.quantity*parseFloat(t.selectedPrice||0),0).toFixed(2)),u=b(()=>a.value),f=b(()=>(u.value*fe).toFixed(2)),h=b(()=>(parseFloat(u.value)+parseFloat(f.value)+m.value).toFixed(2)),r=b(()=>{const s=new Set;return i.value.forEach(t=>{t.selectedListing&&s.add(t.selectedListing.seller_id)}),s.size}),l=b(()=>"3-5"),d=async s=>{try{const t=await y.post("/deck-builder/process",{decklist:s});i.value=t.data,await j()}catch(t){console.error("Error processing decklist:",t)}},_=s=>{s.selectedListing&&(s.selectedPrice=s.selectedListing.price,s.selectedCondition=s.selectedListing.condition)},F=async()=>{try{const s=await y.post("/deck-builder/optimize",{cards:i.value});i.value=s.data}catch(s){console.error("Error optimizing prices:",s)}},A=s=>{i.value=i.value.filter(t=>t.id!==s)},j=async()=>{try{const s=await y.post("/shipping/calculate",{items:i.value.map(t=>{var o;return{seller_id:(o=t.selectedListing)==null?void 0:o.seller_id,quantity:t.quantity}})});m.value=s.data.totalCost}catch(s){console.error("Error calculating shipping:",s)}},S=async()=>{try{await y.post("/cart/add-multiple",{items:i.value.map(s=>({listing_id:s.selectedListing.id,quantity:s.quantity}))})}catch(s){console.error("Error adding to cart:",s)}};return q(()=>{}),(s,t)=>(p(),g("div",K,[e("div",Q,[t[2]||(t[2]=e("h1",{class:"text-3xl font-bold"},"Deck Builder",-1)),e("div",W,[e("button",{onClick:t[0]||(t[0]=o=>v.value=!0),class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"}," Upload Decklist "),e("button",{onClick:F,class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700"}," Optimize Prices ")])]),e("div",X,[e("div",Y,[t[4]||(t[4]=e("h2",{class:"text-xl font-bold mb-4"},"Current Deck",-1)),e("div",Z,[(p(!0),g(k,null,C(i.value,o=>(p(),g("div",{key:o.id,class:"flex justify-between items-center border-b pb-2"},[e("div",ee,[e("img",{src:o.image_url,alt:o.name,class:"w-12 h-16 object-cover rounded"},null,8,te),e("div",null,[e("div",se,n(o.quantity)+"x "+n(o.name),1),e("div",le,"$"+n(o.selectedPrice)+" CAD",1),e("div",oe,n(o.selectedCondition),1)])]),e("div",ne,[D(e("select",{"onUpdate:modelValue":c=>o.selectedListing=c,onChange:c=>_(o),class:"text-sm rounded border-gray-300"},[(p(!0),g(k,null,C(o.availableListings,c=>(p(),g("option",{key:c.id,value:c}," $"+n(c.price)+" - "+n(c.condition)+" ("+n(c.seller_name)+") ",9,ae))),128))],40,ie),[[M,o.selectedListing]]),e("button",{onClick:c=>A(o.id),class:"text-red-600 hover:text-red-800"},[w($(z),{class:"h-5 w-5"})],8,re)])]))),128))]),e("div",de,[e("div",ce,[t[3]||(t[3]=e("span",null,"Total Cost:",-1)),e("span",null,"$"+n(a.value)+" CAD",1)])])]),e("div",ue,[t[9]||(t[9]=e("h2",{class:"text-xl font-bold mb-4"},"Cart Summary",-1)),e("div",pe,[e("div",ve,[t[5]||(t[5]=e("span",null,"Subtotal:",-1)),e("span",null,"$"+n(u.value)+" CAD",1)]),e("div",me,[t[6]||(t[6]=e("span",null,"Shipping:",-1)),e("span",null,"$"+n(m.value)+" CAD",1)]),e("div",be,[t[7]||(t[7]=e("span",null,"Tax:",-1)),e("span",null,"$"+n(f.value)+" CAD",1)]),e("div",ge,[t[8]||(t[8]=e("span",null,"Total:",-1)),e("span",null,"$"+n(h.value)+" CAD",1)])]),e("button",{onClick:S,class:"w-full mt-4 bg-green-600 text-white py-2 rounded hover:bg-green-700"}," Add All to Cart "),e("div",xe,[e("div",null,"Cards from "+n(r.value)+" sellers",1),e("div",null,"Estimated shipping: "+n(l.value)+" days",1)])])]),v.value?(p(),B(J,{key:0,onClose:t[1]||(t[1]=o=>v.value=!1),onUploaded:d})):E("",!0)]))}};export{_e as default};
